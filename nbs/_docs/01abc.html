<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="基本分析モジュール abc とサプライ・チェイン基本分析システム">

<title>scmopt2 - サプライ・チェイン基本分析システム SCBAS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="scmopt2 - サプライ・チェイン基本分析システム SCBAS">
<meta property="og:description" content="">
<meta property="og:image" content="https://scmopt.github.io/scmopt2/01abc_files/figure-html/cell-11-output-1.png">
<meta property="og:site-name" content="scmopt2">
<meta property="og:image:height" content="450">
<meta property="og:image:width" content="700">
<meta name="twitter:title" content="scmopt2 - サプライ・チェイン基本分析システム SCBAS">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://scmopt.github.io/scmopt2/01abc_files/figure-html/cell-11-output-1.png">
<meta name="twitter:image-height" content="450">
<meta name="twitter:image-width" content="700">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">scmopt2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/scmopt/scmopt2" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01abc.html">サプライ・チェイン基本分析システム SCBAS</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01abc.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">サプライ・チェイン基本分析システム SCBAS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scml2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SCML2</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#はじめに" id="toc-はじめに" class="nav-link active" data-scroll-target="#はじめに">はじめに</a></li>
  <li><a href="#データの読み込み" id="toc-データの読み込み" class="nav-link" data-scroll-target="#データの読み込み">データの読み込み</a></li>
  <li><a href="#kaggleデータの読み込み" id="toc-kaggleデータの読み込み" class="nav-link" data-scroll-target="#kaggleデータの読み込み">Kaggleデータの読み込み</a></li>
  <li><a href="#需要と売り上げのtreemapを生成する関数-demand_tree_map" id="toc-需要と売り上げのtreemapを生成する関数-demand_tree_map" class="nav-link" data-scroll-target="#需要と売り上げのtreemapを生成する関数-demand_tree_map">需要と売り上げのtreemapを生成する関数 demand_tree_map</a>
  <ul>
  <li><a href="#demand_tree_map" id="toc-demand_tree_map" class="nav-link" data-scroll-target="#demand_tree_map">demand_tree_map</a></li>
  <li><a href="#demand_tree_mapの使用例" id="toc-demand_tree_mapの使用例" class="nav-link" data-scroll-target="#demand_tree_mapの使用例">demand_tree_mapの使用例</a></li>
  </ul></li>
  <li><a href="#abc分析とランク分析を行うための関数-abc_analysis" id="toc-abc分析とランク分析を行うための関数-abc_analysis" class="nav-link" data-scroll-target="#abc分析とランク分析を行うための関数-abc_analysis">ABC分析とランク分析を行うための関数 abc_analysis</a>
  <ul>
  <li><a href="#abc_analysis" id="toc-abc_analysis" class="nav-link" data-scroll-target="#abc_analysis">abc_analysis</a></li>
  <li><a href="#顧客製品の組に対するabc分析-abc_analysis_all" id="toc-顧客製品の組に対するabc分析-abc_analysis_all" class="nav-link" data-scroll-target="#顧客製品の組に対するabc分析-abc_analysis_all">顧客・製品の組に対するABC分析 abc_analysis_all</a></li>
  <li><a href="#abc_analysis_all" id="toc-abc_analysis_all" class="nav-link" data-scroll-target="#abc_analysis_all">abc_analysis_all</a></li>
  </ul></li>
  <li><a href="#abc_analysis_all関数の使用例" id="toc-abc_analysis_all関数の使用例" class="nav-link" data-scroll-target="#abc_analysis_all関数の使用例">abc_analysis(_all)関数の使用例</a>
  <ul>
  <li><a href="#元のデータフレームにabcとrankとdemandを追加する関数-add_abc" id="toc-元のデータフレームにabcとrankとdemandを追加する関数-add_abc" class="nav-link" data-scroll-target="#元のデータフレームにabcとrankとdemandを追加する関数-add_abc">元のデータフレームにabcとrankとdemandを追加する関数 add_abc</a></li>
  <li><a href="#add_abc" id="toc-add_abc" class="nav-link" data-scroll-target="#add_abc">add_abc</a></li>
  <li><a href="#add_abc関数の使用例" id="toc-add_abc関数の使用例" class="nav-link" data-scroll-target="#add_abc関数の使用例">add_abc関数の使用例</a></li>
  </ul></li>
  <li><a href="#abc別に色分けした需要のtreemapを生成する関数" id="toc-abc別に色分けした需要のtreemapを生成する関数" class="nav-link" data-scroll-target="#abc別に色分けした需要のtreemapを生成する関数">ABC別に色分けした需要のtreemapを生成する関数</a>
  <ul>
  <li><a href="#demand_tree_map_with_abc" id="toc-demand_tree_map_with_abc" class="nav-link" data-scroll-target="#demand_tree_map_with_abc">demand_tree_map_with_abc</a></li>
  <li><a href="#demand_tree_map_with_abc関数の使用例" id="toc-demand_tree_map_with_abc関数の使用例" class="nav-link" data-scroll-target="#demand_tree_map_with_abc関数の使用例">demand_tree_map_with_abc関数の使用例</a></li>
  <li><a href="#需要データフレームからabc分析の図とデータフレームを生成する関数-generate_figures_for_abc_analysis" id="toc-需要データフレームからabc分析の図とデータフレームを生成する関数-generate_figures_for_abc_analysis" class="nav-link" data-scroll-target="#需要データフレームからabc分析の図とデータフレームを生成する関数-generate_figures_for_abc_analysis">需要データフレームからABC分析の図とデータフレームを生成する関数 generate_figures_for_abc_analysis</a></li>
  <li><a href="#generate_figures_for_abc_analysis" id="toc-generate_figures_for_abc_analysis" class="nav-link" data-scroll-target="#generate_figures_for_abc_analysis">generate_figures_for_abc_analysis</a></li>
  <li><a href="#generate_figures_for_abc_analysis関数の使用例" id="toc-generate_figures_for_abc_analysis関数の使用例" class="nav-link" data-scroll-target="#generate_figures_for_abc_analysis関数の使用例">generate_figures_for_abc_analysis関数の使用例</a></li>
  </ul></li>
  <li><a href="#ランク分析のための関数-rank_analysis-と-rank_analysis_all_periods" id="toc-ランク分析のための関数-rank_analysis-と-rank_analysis_all_periods" class="nav-link" data-scroll-target="#ランク分析のための関数-rank_analysis-と-rank_analysis_all_periods">ランク分析のための関数 rank_analysis と rank_analysis_all_periods</a>
  <ul>
  <li><a href="#rank_analysis" id="toc-rank_analysis" class="nav-link" data-scroll-target="#rank_analysis">rank_analysis</a></li>
  <li><a href="#rank_analysis_all_periods" id="toc-rank_analysis_all_periods" class="nav-link" data-scroll-target="#rank_analysis_all_periods">rank_analysis_all_periods</a></li>
  <li><a href="#ランク分析の関数の使用例" id="toc-ランク分析の関数の使用例" class="nav-link" data-scroll-target="#ランク分析の関数の使用例">ランク分析の関数の使用例</a></li>
  <li><a href="#ランク分析の可視化関数-show_rank_analysis" id="toc-ランク分析の可視化関数-show_rank_analysis" class="nav-link" data-scroll-target="#ランク分析の可視化関数-show_rank_analysis">ランク分析の可視化関数 show_rank_analysis</a></li>
  <li><a href="#show_rank_analysis" id="toc-show_rank_analysis" class="nav-link" data-scroll-target="#show_rank_analysis">show_rank_analysis</a></li>
  <li><a href="#show_rank_analysis関数の使用例" id="toc-show_rank_analysis関数の使用例" class="nav-link" data-scroll-target="#show_rank_analysis関数の使用例">show_rank_analysis関数の使用例</a></li>
  </ul></li>
  <li><a href="#リスク共同管理分析-risk_pooling_analysis" id="toc-リスク共同管理分析-risk_pooling_analysis" class="nav-link" data-scroll-target="#リスク共同管理分析-risk_pooling_analysis">リスク共同管理分析 risk_pooling_analysis</a>
  <ul>
  <li><a href="#risk_pooling_analysis" id="toc-risk_pooling_analysis" class="nav-link" data-scroll-target="#risk_pooling_analysis">risk_pooling_analysis</a></li>
  </ul></li>
  <li><a href="#risk_pooling_analysis関数の使用例" id="toc-risk_pooling_analysis関数の使用例" class="nav-link" data-scroll-target="#risk_pooling_analysis関数の使用例">risk_pooling_analysis関数の使用例</a>
  <ul>
  <li><a href="#在庫削減量の可視化関数-show_inventory_reduction" id="toc-在庫削減量の可視化関数-show_inventory_reduction" class="nav-link" data-scroll-target="#在庫削減量の可視化関数-show_inventory_reduction">在庫削減量の可視化関数 show_inventory_reduction</a></li>
  <li><a href="#show_inventory_reduction" id="toc-show_inventory_reduction" class="nav-link" data-scroll-target="#show_inventory_reduction">show_inventory_reduction</a></li>
  <li><a href="#需要の製品ごとの平均と変動係数の可視化関数-show_mean_cv" id="toc-需要の製品ごとの平均と変動係数の可視化関数-show_mean_cv" class="nav-link" data-scroll-target="#需要の製品ごとの平均と変動係数の可視化関数-show_mean_cv">需要の製品ごとの平均と変動係数の可視化関数 show_mean_cv</a></li>
  <li><a href="#show_mean_cv" id="toc-show_mean_cv" class="nav-link" data-scroll-target="#show_mean_cv">show_mean_cv</a>
  <ul class="collapse">
  <li><a href="#show_mean_cv関数の使用例" id="toc-show_mean_cv関数の使用例" class="nav-link" data-scroll-target="#show_mean_cv関数の使用例">show_mean_cv関数の使用例</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#安全在庫ロットサイズ目標在庫基在庫レベルの設定関数-inventory_analysis" id="toc-安全在庫ロットサイズ目標在庫基在庫レベルの設定関数-inventory_analysis" class="nav-link" data-scroll-target="#安全在庫ロットサイズ目標在庫基在庫レベルの設定関数-inventory_analysis">安全在庫、ロットサイズ、目標在庫（基在庫レベル）の設定関数 inventory_analysis</a>
  <ul>
  <li><a href="#inventory_analysis" id="toc-inventory_analysis" class="nav-link" data-scroll-target="#inventory_analysis">inventory_analysis</a></li>
  <li><a href="#inventory_analysis関数の使用例" id="toc-inventory_analysis関数の使用例" class="nav-link" data-scroll-target="#inventory_analysis関数の使用例">inventory_analysis関数の使用例</a></li>
  </ul></li>
  <li><a href="#生産在庫シミュレーション-inventory_simulation" id="toc-生産在庫シミュレーション-inventory_simulation" class="nav-link" data-scroll-target="#生産在庫シミュレーション-inventory_simulation">生産・在庫シミュレーション inventory_simulation</a>
  <ul>
  <li><a href="#inventory_simulation" id="toc-inventory_simulation" class="nav-link" data-scroll-target="#inventory_simulation">inventory_simulation</a></li>
  <li><a href="#inventory_simulation関数の使用例" id="toc-inventory_simulation関数の使用例" class="nav-link" data-scroll-target="#inventory_simulation関数の使用例">inventory_simulation関数の使用例</a></li>
  <li><a href="#生産在庫需要の可視化関数-show_prod_inv_demand" id="toc-生産在庫需要の可視化関数-show_prod_inv_demand" class="nav-link" data-scroll-target="#生産在庫需要の可視化関数-show_prod_inv_demand">生産、在庫、需要の可視化関数 show_prod_inv_demand</a></li>
  <li><a href="#show_prod_inv_demand" id="toc-show_prod_inv_demand" class="nav-link" data-scroll-target="#show_prod_inv_demand">show_prod_inv_demand</a></li>
  <li><a href="#show_prod_inv_demand関数の使用例" id="toc-show_prod_inv_demand関数の使用例" class="nav-link" data-scroll-target="#show_prod_inv_demand関数の使用例">show_prod_inv_demand関数の使用例</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/scmopt/scmopt2/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">サプライ・チェイン基本分析システム SCBAS</h1>
</div>

<div>
  <div class="description">
    基本分析モジュール abc とサプライ・チェイン基本分析システム
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">はじめに</h2>
<p>サプライ・チェイン・アナリティクスで最初に行うことは、需要データに対するABC分析である。 商品の需要量というのは、売れるものはたくさん売れるが、その数はごく少数であり、他のたくさんのそんなに売れない商品が山ほどあるという性質を持つ。 これをパレートの法則（全体の数値の大部分は、全体を構成するうちの一部の要素が生み出しているという理論。別名、80:20の法則、もう1つの別名、ばらつきの法則）と呼ぶ。</p>
<p>ここでは、仮想の企業の需要を生成し、それに対してABC分析を行う。 同時に、商品を売れている順に順位をつけ、順位の時系列的な変化を示すランク分析を提案する。</p>
<p>さらに、簡単な在庫分析を行う。これは、平均需要量や生産固定費用から、生産ロットサイズや安全在庫量を計算するものであり、 古典的な経済発注量モデルや安全在庫モデル（新聞売り子モデル）に基づくものである。</p>
</section>
<section id="データの読み込み" class="level2">
<h2 class="anchored" data-anchor-id="データの読み込み">データの読み込み</h2>
<p>まずは基本となるデータを読み込む。製品データはオプションであり、需要を売り上げや需要を重量や容量で評価したい場合に使う。 基本は、需要データ demand_df だけを使えば十分である。</p>
<p>需要データは以下の列をもつ．</p>
<ul>
<li>date: 日付</li>
<li>cust: 顧客名</li>
<li>prod: 製品名</li>
<li>demand: 需要量</li>
<li>sales: 売上</li>
</ul>
<p>需要量demandと売上の何れかに対して，ABC分析を行う．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>prod_df <span class="op">=</span> pd.read_csv(folder<span class="op">+</span><span class="st">"Prod.csv"</span>,index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>prod_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">cust_value</th>
<th data-quarto-table-cell-role="th">dc_value</th>
<th data-quarto-table-cell-role="th">plnt_value</th>
<th data-quarto-table-cell-role="th">fixed_cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>2</td>
<td>0</td>
<td>7</td>
<td>1</td>
<td>1</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>B</td>
<td>5</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>C</td>
<td>1</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>D</td>
<td>3</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>E</td>
<td>1</td>
<td>0</td>
<td>10</td>
<td>1</td>
<td>1</td>
<td>18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>demand_df <span class="op">=</span> pd.read_csv(folder<span class="op">+</span><span class="st">"demand.csv"</span>,index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>demand_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">cust</th>
<th data-quarto-table-cell-role="th">prod</th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">sales</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-01</td>
<td>札幌市</td>
<td>A</td>
<td>10</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>札幌市</td>
<td>B</td>
<td>10</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-01</td>
<td>札幌市</td>
<td>C</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-01</td>
<td>札幌市</td>
<td>D</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-01</td>
<td>札幌市</td>
<td>E</td>
<td>37</td>
<td>37</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="kaggleデータの読み込み" class="level2">
<h2 class="anchored" data-anchor-id="kaggleデータの読み込み">Kaggleデータの読み込み</h2>
<p>以下で配布されているデータを読み込む．</p>
<p>https://www.kaggle.com/kyanyoga/sample-sales-data</p>
<p>Kaggleデータを用いたい場合には，以下を実行する． ただし，製品データがないので，製品関連の関数は適用できない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>kaggle_df <span class="op">=</span> pd.read_csv(folder <span class="op">+</span> <span class="st">"sales_data_sample.csv"</span>,encoding<span class="op">=</span><span class="st">"latin"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>kaggle_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ORDERNUMBER</th>
<th data-quarto-table-cell-role="th">QUANTITYORDERED</th>
<th data-quarto-table-cell-role="th">PRICEEACH</th>
<th data-quarto-table-cell-role="th">ORDERLINENUMBER</th>
<th data-quarto-table-cell-role="th">SALES</th>
<th data-quarto-table-cell-role="th">ORDERDATE</th>
<th data-quarto-table-cell-role="th">STATUS</th>
<th data-quarto-table-cell-role="th">QTR_ID</th>
<th data-quarto-table-cell-role="th">MONTH_ID</th>
<th data-quarto-table-cell-role="th">YEAR_ID</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ADDRESSLINE1</th>
<th data-quarto-table-cell-role="th">ADDRESSLINE2</th>
<th data-quarto-table-cell-role="th">CITY</th>
<th data-quarto-table-cell-role="th">STATE</th>
<th data-quarto-table-cell-role="th">POSTALCODE</th>
<th data-quarto-table-cell-role="th">COUNTRY</th>
<th data-quarto-table-cell-role="th">TERRITORY</th>
<th data-quarto-table-cell-role="th">CONTACTLASTNAME</th>
<th data-quarto-table-cell-role="th">CONTACTFIRSTNAME</th>
<th data-quarto-table-cell-role="th">DEALSIZE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10107</td>
<td>30</td>
<td>95.70</td>
<td>2</td>
<td>2871.00</td>
<td>2/24/2003 0:00</td>
<td>Shipped</td>
<td>1</td>
<td>2</td>
<td>2003</td>
<td>...</td>
<td>897 Long Airport Avenue</td>
<td>NaN</td>
<td>NYC</td>
<td>NY</td>
<td>10022</td>
<td>USA</td>
<td>NaN</td>
<td>Yu</td>
<td>Kwai</td>
<td>Small</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10121</td>
<td>34</td>
<td>81.35</td>
<td>5</td>
<td>2765.90</td>
<td>5/7/2003 0:00</td>
<td>Shipped</td>
<td>2</td>
<td>5</td>
<td>2003</td>
<td>...</td>
<td>59 rue de l'Abbaye</td>
<td>NaN</td>
<td>Reims</td>
<td>NaN</td>
<td>51100</td>
<td>France</td>
<td>EMEA</td>
<td>Henriot</td>
<td>Paul</td>
<td>Small</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>10134</td>
<td>41</td>
<td>94.74</td>
<td>2</td>
<td>3884.34</td>
<td>7/1/2003 0:00</td>
<td>Shipped</td>
<td>3</td>
<td>7</td>
<td>2003</td>
<td>...</td>
<td>27 rue du Colonel Pierre Avia</td>
<td>NaN</td>
<td>Paris</td>
<td>NaN</td>
<td>75508</td>
<td>France</td>
<td>EMEA</td>
<td>Da Cunha</td>
<td>Daniel</td>
<td>Medium</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>10145</td>
<td>45</td>
<td>83.26</td>
<td>6</td>
<td>3746.70</td>
<td>8/25/2003 0:00</td>
<td>Shipped</td>
<td>3</td>
<td>8</td>
<td>2003</td>
<td>...</td>
<td>78934 Hillside Dr.</td>
<td>NaN</td>
<td>Pasadena</td>
<td>CA</td>
<td>90003</td>
<td>USA</td>
<td>NaN</td>
<td>Young</td>
<td>Julie</td>
<td>Medium</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10159</td>
<td>49</td>
<td>100.00</td>
<td>14</td>
<td>5205.27</td>
<td>10/10/2003 0:00</td>
<td>Shipped</td>
<td>4</td>
<td>10</td>
<td>2003</td>
<td>...</td>
<td>7734 Strong St.</td>
<td>NaN</td>
<td>San Francisco</td>
<td>CA</td>
<td>NaN</td>
<td>USA</td>
<td>NaN</td>
<td>Brown</td>
<td>Julie</td>
<td>Medium</td>
</tr>
</tbody>
</table>

<p>5 rows × 25 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>kaggle_df[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(kaggle_df.ORDERDATE)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>kaggle_df.rename(columns<span class="op">=</span>{<span class="st">"PRODUCTLINE"</span>:<span class="st">"prod"</span>, <span class="st">"CITY"</span>:<span class="st">"cust"</span>, <span class="st">"QUANTITYORDERED"</span>:<span class="st">"demand"</span>, <span class="st">"SALES"</span>:<span class="st">"sales"</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>kaggle_demand_df <span class="op">=</span> kaggle_df[[<span class="st">"date"</span>,<span class="st">"cust"</span>,<span class="st">"prod"</span>,<span class="st">"demand"</span>,<span class="st">"sales"</span>]].copy()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>kaggle_demand_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">cust</th>
<th data-quarto-table-cell-role="th">prod</th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2003-02-24</td>
<td>NYC</td>
<td>Motorcycles</td>
<td>30</td>
<td>2871.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2003-05-07</td>
<td>Reims</td>
<td>Motorcycles</td>
<td>34</td>
<td>2765.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2003-07-01</td>
<td>Paris</td>
<td>Motorcycles</td>
<td>41</td>
<td>3884.34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2003-08-25</td>
<td>Pasadena</td>
<td>Motorcycles</td>
<td>45</td>
<td>3746.70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2003-10-10</td>
<td>San Francisco</td>
<td>Motorcycles</td>
<td>49</td>
<td>5205.27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="需要と売り上げのtreemapを生成する関数-demand_tree_map" class="level2">
<h2 class="anchored" data-anchor-id="需要と売り上げのtreemapを生成する関数-demand_tree_map">需要と売り上げのtreemapを生成する関数 demand_tree_map</h2>
<p>引数： - 需要データフレーム（需要 demand と売り上げ sales の列を含む）</p>
<p>返値： - Plotlyのtreemapオブジェクト</p>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L33" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="demand_tree_map" class="level3">
<h3 class="anchored" data-anchor-id="demand_tree_map">demand_tree_map</h3>
<blockquote class="blockquote">
<pre><code> demand_tree_map (demand_df:pandas.core.frame.DataFrame)</code></pre>
</blockquote>
<p>需要と売り上げのtreemapを生成する関数</p>
</section>
<section id="demand_tree_mapの使用例" class="level3">
<h3 class="anchored" data-anchor-id="demand_tree_mapの使用例">demand_tree_mapの使用例</h3>
<p>sales列がない場合には，dataモジュールのdemand_attribute_compute関数を用いてsales（売り上げ）列を計算することができる。</p>
<p>需要のtreemapは，需要の大きさを面積とした階層図であり，売上は色で表現している．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> demand_tree_map(demand_df)<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="abc分析とランク分析を行うための関数-abc_analysis" class="level2">
<h2 class="anchored" data-anchor-id="abc分析とランク分析を行うための関数-abc_analysis">ABC分析とランク分析を行うための関数 abc_analysis</h2>
<p>ABC分析のための関数を記述する、基本的には、需要データ demand_df だけあれば良いが、顧客や製品に関連した量を分析に加えたいときには、顧客データ cust_df や 製品データ prod_df も読み込んでおく。</p>
<p>古典的なABC分析では、3つのカテゴリーに製品や顧客を分類していたが、場合によっては4つに分類したい場合もあるだろう。 ここでは、より一般的にユーザーが与えた任意の数への分類を行う関数を準備する、カテゴリーに含まれる需要量を、ユーザーが与えた閾値をもとにして分類を行う。</p>
<p>引数:</p>
<ul>
<li>df: ABC分析を行うための需要データフレーム．列に集約を行うための列と値を格納した列が必要．</li>
<li>threshold: A,B,C の分類を行うための閾値．上位 threshold[0]の要素がAランク，次に上位の threshold[1]がBランク、と順に決めていく。 リストの長さは（アルファベットの数以下の）任意の正数であるが、合計が1以上になるような数値のリストとして与える．</li>
<li>agg_col: 集約を行う列名を文字列として与える．</li>
<li>value_column: A,B,Cの分類を行うための数値データを保管した列名を文字列として与える．</li>
<li>abc_name: 分類した結果を入れるための列名を文字列として与える．</li>
<li>rank_name: 数値データの順位を入れた列名を文字列として与える．</li>
</ul>
<p>返値: 以下の3つのオブジェクトのタプル：</p>
<ul>
<li>agg_df: agg_colによって集約したデータをvalue_columnの数値の大きい順に並べたデータフレーム．abcとrankの情報が付加されている．</li>
<li>new_df: 元のデータフレームにabc_nameで与えた列にA(=0),B(=1),C(=2)の分類を，rank_nameで与えた列にランク（順位）を入れている．</li>
<li>category: 0,1,2, …をキーとして与えると A,B,C,… ランクに属するデータ名（agg_colの要素）のリストを値として返す辞書．</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L51" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="abc_analysis" class="level3">
<h3 class="anchored" data-anchor-id="abc_analysis">abc_analysis</h3>
<blockquote class="blockquote">
<pre><code> abc_analysis (df:pandas.core.frame.DataFrame, threshold:list[float],
               agg_col:str, value_column:str, abc_name:str, rank_name:str)</code></pre>
</blockquote>
<p>ABC分析のための関数</p>
</section>
<section id="顧客製品の組に対するabc分析-abc_analysis_all" class="level3">
<h3 class="anchored" data-anchor-id="顧客製品の組に対するabc分析-abc_analysis_all">顧客・製品の組に対するABC分析 abc_analysis_all</h3>
<p>顧客・製品ごとに需要予測を行う際に，予測しなくても良い組を予め抜き出しておくことが重要になる．そのため，顧客・製品の組に対してABC分析とランク分析を行う関数を準備しておく．</p>
<p>引数:</p>
<ul>
<li>df: ABC分析を行うための需要データフレーム．列に集約を行うための列と値を格納した列が必要．</li>
<li>threshold: A,B,C の分類を行うための閾値．上位 threshold[0]の要素がAランク，次に上位の threshold[1]がBランク、と順に決めていく。</li>
</ul>
<p>返値: 以下の3つのオブジェクトのタプル：</p>
<ul>
<li>agg_df: 顧客・製品によって集約したデータをdemandの数値の合計（sum)の大きい順に並べたデータフレーム． abcとrankと需要の標準偏差 (std) の情報が付加されている．</li>
<li>category: 0,1,2, …をキーとして与えると A,B,C,… ランクに属するデータ名（agg_colの要素）のリストを値として返す辞書．</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L120" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="abc_analysis_all" class="level3">
<h3 class="anchored" data-anchor-id="abc_analysis_all">abc_analysis_all</h3>
<blockquote class="blockquote">
<pre><code> abc_analysis_all (df:pandas.core.frame.DataFrame, threshold:list[float])</code></pre>
</blockquote>
</section>
</section>
<section id="abc_analysis_all関数の使用例" class="level2">
<h2 class="anchored" data-anchor-id="abc_analysis_all関数の使用例">abc_analysis(_all)関数の使用例</h2>
<p>以下では、製品と顧客に対してABC分析を行い、得られた3種類のデータフレーム（元のデータフレームに列を追加したもの：new_df、製品データフレームagg_df_prod、顧客データフレーム：agg_df_cust）を示す。</p>
<ul>
<li>確認用の小規模例</li>
<li>製品を需要量を元に3つのクラスに、閾値[0.4, 0.5, 0.1]を用いて分類</li>
<li>顧客を需要量を元に4つのクラスに、閾値[0.4, 0.3, 0.3, 0.1]を用いて分類</li>
<li>顧客・製品を元に4つのクラスに、閾値[0.4, 0.3, 0.3, 0.1]を用いて分類</li>
</ul>
<p>#hide - 製品を売り上げを元に4つのクラスに、閾値[0.6, 0.2, 0.1, 0.1]を用いて分類 （これを行うためには、data_generationモジュールのdemand_attribute_compute関数で、Salesの列を生成しておく必要がある。）</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>agg_df_prod, new_df, category_prod <span class="op">=</span> abc_analysis(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    demand_df, [<span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>], <span class="st">'prod'</span>, <span class="st">'demand'</span>, <span class="st">"prod_ABC"</span>, <span class="st">"prod_rank"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>agg_df_cust, new_df, category_cust <span class="op">=</span> abc_analysis(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    demand_df, [<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>], <span class="st">'cust'</span>, <span class="st">'demand'</span>, <span class="st">"customer_ABC"</span>, <span class="st">"customer_rank"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>new_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">cust</th>
<th data-quarto-table-cell-role="th">prod</th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">abc</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">prod_ABC</th>
<th data-quarto-table-cell-role="th">prod_rank</th>
<th data-quarto-table-cell-role="th">customer_ABC</th>
<th data-quarto-table-cell-role="th">customer_rank</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>0</td>
<td>札幌市</td>
<td>A</td>
<td>10</td>
<td>10</td>
<td>B</td>
<td>3</td>
<td>B</td>
<td>3</td>
<td>C</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>1</td>
<td>札幌市</td>
<td>B</td>
<td>10</td>
<td>10</td>
<td>B</td>
<td>4</td>
<td>B</td>
<td>4</td>
<td>C</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>2</td>
<td>札幌市</td>
<td>C</td>
<td>3</td>
<td>3</td>
<td>C</td>
<td>7</td>
<td>C</td>
<td>7</td>
<td>C</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>3</td>
<td>札幌市</td>
<td>D</td>
<td>0</td>
<td>0</td>
<td>C</td>
<td>9</td>
<td>C</td>
<td>9</td>
<td>C</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>4</td>
<td>札幌市</td>
<td>E</td>
<td>37</td>
<td>37</td>
<td>A</td>
<td>0</td>
<td>A</td>
<td>0</td>
<td>C</td>
<td>24</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>agg_df_prod.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">abc</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">prod</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">E</td>
<td>77704</td>
<td>0</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">J</td>
<td>52907</td>
<td>1</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">H</td>
<td>39424</td>
<td>2</td>
<td>B</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">A</td>
<td>18026</td>
<td>3</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">B</td>
<td>17592</td>
<td>4</td>
<td>B</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>agg_df_cust.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">abc</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cust</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">佐賀市</td>
<td>55317</td>
<td>0</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">静岡市</td>
<td>27902</td>
<td>1</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">岡山市</td>
<td>22976</td>
<td>2</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">那覇市</td>
<td>12990</td>
<td>3</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">京都市</td>
<td>11593</td>
<td>4</td>
<td>B</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>agg_df,category <span class="op">=</span> abc_analysis_all(demand_df, threshold<span class="op">=</span>[<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>agg_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sum</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">abc</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cust</th>
<th data-quarto-table-cell-role="th">prod</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">佐賀市</td>
<td data-quarto-table-cell-role="th">E</td>
<td>17587</td>
<td>471.906473</td>
<td>0</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">J</td>
<td>11990</td>
<td>322.062341</td>
<td>1</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">H</td>
<td>8939</td>
<td>239.820182</td>
<td>2</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">静岡市</td>
<td data-quarto-table-cell-role="th">E</td>
<td>8877</td>
<td>238.403449</td>
<td>3</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">岡山市</td>
<td data-quarto-table-cell-role="th">E</td>
<td>7310</td>
<td>196.151534</td>
<td>4</td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="元のデータフレームにabcとrankとdemandを追加する関数-add_abc" class="level3">
<h3 class="anchored" data-anchor-id="元のデータフレームにabcとrankとdemandを追加する関数-add_abc">元のデータフレームにabcとrankとdemandを追加する関数 add_abc</h3>
<p>引数： - df: 製品や顧客のデータフレーム；これにABC分析の結果を追加する． - agg_df: 集約した需要，ABC分類，ランクを保管したデータフレーム；インデックスは製品(prod)もしくは顧客 (cust) - col_name: 追加したいデータの列名；製品の場合にはprod（既定値），顧客の場合にはcust</p>
<p>返値： - df: ランク，ABC分類，集約した需要量を追加したデータフレーム</p>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L167" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="add_abc" class="level3">
<h3 class="anchored" data-anchor-id="add_abc">add_abc</h3>
<blockquote class="blockquote">
<pre><code> add_abc (df:pandas.core.frame.DataFrame,
          agg_df:pandas.core.frame.DataFrame, col_name:str='prod')</code></pre>
</blockquote>
</section>
<section id="add_abc関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="add_abc関数の使用例">add_abc関数の使用例</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>new_prod_df <span class="op">=</span> add_abc(prod_df, agg_df_prod)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>new_prod_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">plnt_value</th>
<th data-quarto-table-cell-role="th">fixed_cost</th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">abc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1</td>
<td>14</td>
<td>18026</td>
<td>3</td>
<td>B</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>B</td>
<td>1</td>
<td>14</td>
<td>17592</td>
<td>4</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>C</td>
<td>1</td>
<td>19</td>
<td>6682</td>
<td>7</td>
<td>C</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>D</td>
<td>1</td>
<td>17</td>
<td>813</td>
<td>9</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>E</td>
<td>1</td>
<td>18</td>
<td>77704</td>
<td>0</td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="abc別に色分けした需要のtreemapを生成する関数" class="level2">
<h2 class="anchored" data-anchor-id="abc別に色分けした需要のtreemapを生成する関数">ABC別に色分けした需要のtreemapを生成する関数</h2>
<p>引数： - 需要データフレーム（需要 demand，売り上げ sales，customer_ABC, prod_ABCの列を含む； ABC分析で得られたnew_df）</p>
<p>返値： - Plotlyのtreemapオブジェクト</p>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L189" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="demand_tree_map_with_abc" class="level3">
<h3 class="anchored" data-anchor-id="demand_tree_map_with_abc">demand_tree_map_with_abc</h3>
<blockquote class="blockquote">
<pre><code> demand_tree_map_with_abc (demand_df:pandas.core.frame.DataFrame)</code></pre>
</blockquote>
<p>ABC別に色分けした需要のtreemapを生成する関数</p>
</section>
<section id="demand_tree_map_with_abc関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="demand_tree_map_with_abc関数の使用例">demand_tree_map_with_abc関数の使用例</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> demand_tree_map_with_abc(new_df)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="需要データフレームからabc分析の図とデータフレームを生成する関数-generate_figures_for_abc_analysis" class="level3">
<h3 class="anchored" data-anchor-id="需要データフレームからabc分析の図とデータフレームを生成する関数-generate_figures_for_abc_analysis">需要データフレームからABC分析の図とデータフレームを生成する関数 generate_figures_for_abc_analysis</h3>
<p>顧客と製品の両方に対するABC分析を同時に行い、結果の図とデータフレームを同時に得るには、この関数を用いる。</p>
<p>引数：</p>
<ul>
<li>demand_df : 需要データフレーム</li>
<li>value_name: 分析をするデータが入っている列名（既定値は”demand”）</li>
<li>cumsum : 図を累積値で描画するときには True</li>
<li>cust_thres : 顧客のABC分析するときの閾値を文字列で表したもの</li>
<li>prod_thres : 製品のABC分析するときの閾値を文字列で表したもの</li>
</ul>
<p>返値：</p>
<ul>
<li>fig_prod : 製品のABC分析のPlotly図オブジェクト</li>
<li>fig_cust : 顧客のABC分析のPlotly図オブジェクト</li>
<li>agg_df_prod : 製品をインデックスとしたABC分析のデータフレーム</li>
<li>agg_df_cust : 顧客をインデックスとしたABC分析のデータフレーム</li>
<li>new_df : 顧客と製品のABCとランクを加えた新しい需要データフレーム</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L209" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="generate_figures_for_abc_analysis" class="level3">
<h3 class="anchored" data-anchor-id="generate_figures_for_abc_analysis">generate_figures_for_abc_analysis</h3>
<blockquote class="blockquote">
<pre><code> generate_figures_for_abc_analysis (demand_df:pandas.core.frame.DataFrame,
                                    value_name:str='demand',
                                    cumsum:bool=True, cust_thres:str='0.7,
                                    0.2, 0.1', prod_thres:str='0.7, 0.2,
                                    0.1')</code></pre>
</blockquote>
</section>
<section id="generate_figures_for_abc_analysis関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="generate_figures_for_abc_analysis関数の使用例">generate_figures_for_abc_analysis関数の使用例</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig_prod, fig_cust, agg_df_prod, agg_df_cust, new_df <span class="op">=</span> generate_figures_for_abc_analysis(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>demand_df, value_name<span class="op">=</span><span class="st">"sales"</span>, cumsum <span class="op">=</span> <span class="va">False</span>, cust_thres<span class="op">=</span><span class="st">"0.7, 0.2, 0.1"</span>, prod_thres<span class="op">=</span><span class="st">"0.7, 0.2, 0.1"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig_cust)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="ランク分析のための関数-rank_analysis-と-rank_analysis_all_periods" class="level2">
<h2 class="anchored" data-anchor-id="ランク分析のための関数-rank_analysis-と-rank_analysis_all_periods">ランク分析のための関数 rank_analysis と rank_analysis_all_periods</h2>
<p>全ての期に対するランク分析を行う関数 rank_analysis と、期ごと（集約する単位は文字列で与える）のランク分析を行う関数 rank_analysis_all_periodsを記述する。</p>
<p>引数:</p>
<ul>
<li>df: ランク分析を行う対象の需要データフレーム．列に集約を行うための列と，値を格納した列が必要．</li>
<li>agg_col: 集約を行う列名を文字列として与える．</li>
<li>value_column: ランクを計算するための数値データを保管した列名を文字列として与える．</li>
<li>agg_period （rank_analysis_all_periodsの場合のみ） : 集約を行う期間を “1m”（月次）のような文字列で与える．</li>
</ul>
<p>返値:</p>
<ul>
<li>名前を入れるとランク（rank_analysisの場合）もしくランクの期別リスト（rank_analysis_all_periodsの場合）を返す辞書</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L296" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="rank_analysis" class="level3">
<h3 class="anchored" data-anchor-id="rank_analysis">rank_analysis</h3>
<blockquote class="blockquote">
<pre><code> rank_analysis (df:pandas.core.frame.DataFrame, agg_col:str,
                value_column:str)</code></pre>
</blockquote>
<p>全期間分のランク分析のための関数</p>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L313" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="rank_analysis_all_periods" class="level3">
<h3 class="anchored" data-anchor-id="rank_analysis_all_periods">rank_analysis_all_periods</h3>
<blockquote class="blockquote">
<pre><code> rank_analysis_all_periods (df:pandas.core.frame.DataFrame, agg_col:str,
                            value_column:str, agg_period:str)</code></pre>
</blockquote>
<p>期別のランク分析のための関数</p>
</section>
<section id="ランク分析の関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="ランク分析の関数の使用例">ランク分析の関数の使用例</h3>
<p>全期間分の顧客需要のランク分析と、３ヶ月を１期とした各期間に対する製品のランク分析。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dic <span class="op">=</span> rank_analysis(demand_df, <span class="st">'cust'</span>, <span class="st">'demand'</span>) <span class="co">#全ての期間に対する顧客需要量のランク分析</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dic.popitem()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>('盛岡市', 47)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dic <span class="op">=</span> rank_analysis_all_periods(demand_df, <span class="st">'prod'</span>, <span class="st">'demand'</span>, <span class="st">"1d"</span>) </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dic.popitem()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>('F', [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7])</code></pre>
</div>
</div>
</section>
<section id="ランク分析の可視化関数-show_rank_analysis" class="level3">
<h3 class="anchored" data-anchor-id="ランク分析の可視化関数-show_rank_analysis">ランク分析の可視化関数 show_rank_analysis</h3>
<p>ランクの時系列的な変化を表す図を生成するための関数。</p>
<p>引数:</p>
<ul>
<li>df: ランク分析を行う対象の需要データフレーム．列に集約を行うための列と，値を格納した列が必要．</li>
<li>value_name: 分析をするデータが入っている列名（既定値は”demand”）</li>
<li>agg_period: 集約を行う期間を “1m”（月次）のような文字列で与える．</li>
<li>top_rank: 上位 top_rank 個のものだけを表示する</li>
</ul>
<p>返値:</p>
<ul>
<li>Plotlyの図オブジェクト</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L346" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_rank_analysis" class="level3">
<h3 class="anchored" data-anchor-id="show_rank_analysis">show_rank_analysis</h3>
<blockquote class="blockquote">
<pre><code> show_rank_analysis (demand_df:pandas.core.frame.DataFrame,
                     value_name:str='demand', agg_period:str='1m',
                     top_rank:int=1)</code></pre>
</blockquote>
<p>ランク分析の可視化関数</p>
</section>
<section id="show_rank_analysis関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="show_rank_analysis関数の使用例">show_rank_analysis関数の使用例</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> show_rank_analysis(demand_df, value_name<span class="op">=</span><span class="st">"sales"</span>, agg_period <span class="op">=</span><span class="st">"1d"</span>, top_rank <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="リスク共同管理分析-risk_pooling_analysis" class="level2">
<h2 class="anchored" data-anchor-id="リスク共同管理分析-risk_pooling_analysis">リスク共同管理分析 risk_pooling_analysis</h2>
<p>在庫をサプライ・チェインの上流（供給側）でもつか、下流（需要側）でもつかは、複数の需要地点（顧客）における需要の相関で決まる。 一般には、上流で在庫を共有することによって在庫の削減ができる。これをリスク共同管理 (risk pooling) とよぶ。</p>
<p>ここでは、製品ごとに、顧客の需要の標準偏差とリスク共同管理した場合の標準偏差の差を計算する。 また、それを需要の総量で割った比率（削減率）も計算する。 これは、標準偏差を平均値で割ることによる無次元の指標（変動係数： coefficient of variation: CV)に相当するものである。</p>
<p>この値が大きい製品ほど、リスク共同管理の効果が大きいので、サプライ・チェインの上流で在庫を保持した方が良いことになり、 逆に小さい製品ほど、下流で在庫を保持した方が良いことになる。</p>
<p>引数： - demand_df: 需要のデータフレーム - agg_period: 標準偏差を計算する際に用いる需要の集約を行う期（規定値は週）</p>
<p>返値： - inv_reduction_df : 標準偏差とその差と削減率を製品ごとに計算したデータフレーム； Rank列は製品の順位</p>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L397" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="risk_pooling_analysis" class="level3">
<h3 class="anchored" data-anchor-id="risk_pooling_analysis">risk_pooling_analysis</h3>
<blockquote class="blockquote">
<pre><code> risk_pooling_analysis (demand_df:pandas.core.frame.DataFrame,
                        agg_period='1w')</code></pre>
</blockquote>
<p>リスク共同管理の効果を見るための関数</p>
<p>在庫を顧客側においた場合と、倉庫側においた場合の差を、標準偏差を計算することによって推定する。</p>
</section>
</section>
<section id="risk_pooling_analysis関数の使用例" class="level2">
<h2 class="anchored" data-anchor-id="risk_pooling_analysis関数の使用例">risk_pooling_analysis関数の使用例</h2>
<p>１週間を単位とした標準偏差をもとに、在庫を倉庫に置いた場合と工場に置いた場合の差を計算し、それを需要の総量で除した削減率(ReductionRatioの列）を計算する。 Plotlyによる可視化では、削減率の大きいものから棒グラフで表示し、需要の大きさのランクで色分けをする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>inv_reduction_df <span class="op">=</span> risk_pooling_analysis(demand_df, agg_period<span class="op">=</span><span class="st">"1w"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>inv_reduction_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">prod</th>
<th data-quarto-table-cell-role="th">agg_std</th>
<th data-quarto-table-cell-role="th">sum_std</th>
<th data-quarto-table-cell-role="th">reduction</th>
<th data-quarto-table-cell-role="th">reduction_ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10</td>
<td>D</td>
<td>20.506097</td>
<td>61.518290</td>
<td>41.012193</td>
<td>0.050446</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>9</td>
<td>I</td>
<td>101.823376</td>
<td>142.835570</td>
<td>41.012193</td>
<td>0.016353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8</td>
<td>C</td>
<td>302.641702</td>
<td>332.340187</td>
<td>29.698485</td>
<td>0.004445</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>A</td>
<td>749.533188</td>
<td>782.060100</td>
<td>32.526912</td>
<td>0.001804</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>F</td>
<td>513.359523</td>
<td>524.673232</td>
<td>11.313708</td>
<td>0.000956</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="在庫削減量の可視化関数-show_inventory_reduction" class="level3">
<h3 class="anchored" data-anchor-id="在庫削減量の可視化関数-show_inventory_reduction">在庫削減量の可視化関数 show_inventory_reduction</h3>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L449" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_inventory_reduction" class="level3">
<h3 class="anchored" data-anchor-id="show_inventory_reduction">show_inventory_reduction</h3>
<blockquote class="blockquote">
<pre><code> show_inventory_reduction (inv_reduction_df:pandas.core.frame.DataFrame)</code></pre>
</blockquote>
<p>在庫削減量の可視化関数</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> show_inventory_reduction(inv_reduction_df)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="需要の製品ごとの平均と変動係数の可視化関数-show_mean_cv" class="level3">
<h3 class="anchored" data-anchor-id="需要の製品ごとの平均と変動係数の可視化関数-show_mean_cv">需要の製品ごとの平均と変動係数の可視化関数 show_mean_cv</h3>
<p>需要を製品ごとに集約し，横軸に平均，縦軸に変動係数(<span class="math inline">\(CV=\sigma/\mu\)</span>)の対数をとった散布図を生成する．</p>
<p>平均が大きく，変動係数が小さい製品は安定しているので倉庫（サプライ・チェインの下流）で保管し，平均が小さく変動係数が大きい製品は，工場（サプライ・チェインの上流）で 保管し，適宜顧客側に流す戦略が望ましい．</p>
<p>引数： - demand: 需要データフレーム - show_name: Trueのとき製品名も描画する．</p>
<p>返値： - fig: Plotlyの図オブジェクト</p>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L463" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_mean_cv" class="level3">
<h3 class="anchored" data-anchor-id="show_mean_cv">show_mean_cv</h3>
<blockquote class="blockquote">
<pre><code> show_mean_cv (demand_df:pandas.core.frame.DataFrame, show_name:bool=True)</code></pre>
</blockquote>
<section id="show_mean_cv関数の使用例" class="level4">
<h4 class="anchored" data-anchor-id="show_mean_cv関数の使用例">show_mean_cv関数の使用例</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> show_mean_cv(demand_df, show_name<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="安全在庫ロットサイズ目標在庫基在庫レベルの設定関数-inventory_analysis" class="level2">
<h2 class="anchored" data-anchor-id="安全在庫ロットサイズ目標在庫基在庫レベルの設定関数-inventory_analysis">安全在庫、ロットサイズ、目標在庫（基在庫レベル）の設定関数 inventory_analysis</h2>
<p>全ての需要が1つの工場で生産していると仮定したとき、その生産ロットサイズや安全在庫量は、古典的な経済発注量モデルと新聞売り子モデルで計算できる。</p>
<ul>
<li><p>安全在庫量: 安全在庫係数 <span class="math inline">\(z\)</span>, リード時間 <span class="math inline">\(L\)</span>， 需要の標準偏差 <span class="math inline">\(\sigma\)</span> としたとき <span class="math inline">\(z\sqrt{LT}\sigma\)</span></p></li>
<li><p>経済発注量（生産ロットサイズ）: 生産固定費用 <span class="math inline">\(FC\)</span>、需要の平均値 <span class="math inline">\(d\)</span>、在庫費用 <span class="math inline">\(h\)</span> としたとき <span class="math inline">\(\sqrt{2 FCd/h}\)</span></p></li>
<li><p>保管費率（無次元）： <span class="math inline">\(r\)</span> は以下の量の和とする。</p>
<ol type="1">
<li>利子率（投資額利率）</li>
<li>保険料率: 製品の種類および企業の方針によっても異なる．</li>
<li>消耗費率および陳腐化率: 製品の腐敗，破損，目減りなどを考慮して計算</li>
<li>税率: 在庫に課せられる法的な税率（日本では0)</li>
</ol></li>
<li><p>在庫費用： <span class="math inline">\(h\)</span> は、保管費率 <span class="math inline">\(r\)</span> に製品の価値（製品データのplnt_value列)を乗じたものを週あたりに換算したもの</p></li>
<li><p>目標在庫量 <span class="math inline">\(=\)</span> 安全在庫量 <span class="math inline">\(+\)</span> ロットサイズ</p></li>
<li><p>初期在庫量 <span class="math inline">\(=\)</span> 安全在庫量と目標在庫量の平均</p></li>
</ul>
<p>引数：</p>
<ul>
<li>prod_df: 製品データフレーム</li>
<li>demand_df: 多期間の製品別需要データフレーム</li>
<li>inv_reduction_df : 標準偏差とその差と削減率を製品ごとに計算したデータフレーム</li>
<li>z: 安全在庫係数　</li>
<li>LT: リード時間</li>
<li>r: 年間保管費率</li>
<li>num_days: 標準偏差を計算する際の日数（既定値は <span class="math inline">\(7\)</span>）</li>
</ul>
<p>返値： 以下の列情報を加えた製品データフレーム prod_df</p>
<ul>
<li>average_demand: num_days間の平均需要</li>
<li>standard_deviation： 需要の標準偏差</li>
<li>inv_cost： 在庫費用 $h = r $ plnt_value を1週間に換算したもの</li>
<li>safety_inventory: 安全在庫量</li>
<li>target_inventory: 目標在庫量（基在庫レベル）；　 <span class="math inline">\(d LT + z\sqrt{LT}\sigma\)</span></li>
<li>initial_inventory: 初期在庫量</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L483" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="inventory_analysis" class="level3">
<h3 class="anchored" data-anchor-id="inventory_analysis">inventory_analysis</h3>
<blockquote class="blockquote">
<pre><code> inventory_analysis (prod_df:pandas.core.frame.DataFrame,
                     demand_df:pandas.core.frame.DataFrame,
                     inv_reduction_df:pandas.core.frame.DataFrame,
                     z:float=1.65, LT:int=1, r:float=0.3, num_days:int=7)</code></pre>
</blockquote>
<p>工場における安全在庫量の計算</p>
<p>工場を１箇所に集約したと仮定する。複数工場の場合には、顧客と工場の紐付け情報が必要になる。</p>
</section>
<section id="inventory_analysis関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="inventory_analysis関数の使用例">inventory_analysis関数の使用例</h3>
<p>１週間を基本単位として、在庫量削減データフレームを計算し、それをもとに工場での在庫量を求める。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>prod_df <span class="op">=</span> pd.read_csv(folder<span class="op">+</span><span class="st">"Prod.csv"</span>,index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>inv_reduction_df <span class="op">=</span> risk_pooling_analysis(demand_df, agg_period<span class="op">=</span><span class="st">"1w"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>prod_df2 <span class="op">=</span> inventory_analysis(prod_df, demand_df, inv_reduction_df, z <span class="op">=</span> <span class="fl">1.65</span>, LT <span class="op">=</span> <span class="dv">1</span>, r <span class="op">=</span> <span class="fl">0.3</span>, num_days<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>prod_df2.set_index(<span class="st">"index"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>prod_df2.to_csv(folder <span class="op">+</span> <span class="st">"Prod_with_inventory.csv"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>prod_df2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">cust_value</th>
<th data-quarto-table-cell-role="th">dc_value</th>
<th data-quarto-table-cell-role="th">plnt_value</th>
<th data-quarto-table-cell-role="th">fixed_cost</th>
<th data-quarto-table-cell-role="th">average_demand</th>
<th data-quarto-table-cell-role="th">standard_deviation</th>
<th data-quarto-table-cell-role="th">inv_cost</th>
<th data-quarto-table-cell-role="th">lot_size</th>
<th data-quarto-table-cell-role="th">safety_inventory</th>
<th data-quarto-table-cell-role="th">target_inventory</th>
<th data-quarto-table-cell-role="th">initial_inventory</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>2</td>
<td>0</td>
<td>7</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>11471.090909</td>
<td>749.533188</td>
<td>0.005753</td>
<td>7471.678242</td>
<td>1236.729760</td>
<td>8708.408003</td>
<td>4972.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>B</td>
<td>5</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>11194.909091</td>
<td>760.846897</td>
<td>0.005753</td>
<td>7381.184926</td>
<td>1255.397379</td>
<td>8636.582305</td>
<td>4945.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>C</td>
<td>1</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>19</td>
<td>4252.181818</td>
<td>302.641702</td>
<td>0.005753</td>
<td>5299.495116</td>
<td>499.358809</td>
<td>5798.853925</td>
<td>3149.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>D</td>
<td>3</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>17</td>
<td>517.363636</td>
<td>20.506097</td>
<td>0.005753</td>
<td>1748.534451</td>
<td>33.835059</td>
<td>1782.369511</td>
<td>908.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>E</td>
<td>1</td>
<td>0</td>
<td>10</td>
<td>1</td>
<td>1</td>
<td>18</td>
<td>49448.000000</td>
<td>3426.639462</td>
<td>0.005753</td>
<td>17589.860716</td>
<td>5653.955112</td>
<td>23243.815827</td>
<td>14448.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="生産在庫シミュレーション-inventory_simulation" class="level2">
<h2 class="anchored" data-anchor-id="生産在庫シミュレーション-inventory_simulation">生産・在庫シミュレーション inventory_simulation</h2>
<p>上で生成したデータを用いて、シミュレーションを行う。生産は、安全在庫量を下回ったときに行われ、目標在庫量になるように生産量を決める。</p>
<p>引数：</p>
<ul>
<li>prod_df: 製品データ</li>
<li>demand_df: 需要データ</li>
</ul>
<p>返値：</p>
<ul>
<li>キーを製品名、値を、需要 demand、在庫 inventory、生産量 production を列とした時系列データフレームとした辞書</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L530" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="inventory_simulation" class="level3">
<h3 class="anchored" data-anchor-id="inventory_simulation">inventory_simulation</h3>
<blockquote class="blockquote">
<pre><code> inventory_simulation (prod_df:pandas.core.frame.DataFrame,
                       demand_df:pandas.core.frame.DataFrame)</code></pre>
</blockquote>
<p>(Q,R)方策のシミュレーション</p>
</section>
<section id="inventory_simulation関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="inventory_simulation関数の使用例">inventory_simulation関数の使用例</h3>
<p>製品 A に対する需要、在庫、生産量を表すデータフレームを表示する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>production_df <span class="op">=</span> inventory_simulation(prod_df, demand_df)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>production_df[prod_df.name[<span class="dv">0</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">demand</th>
<th data-quarto-table-cell-role="th">inventory</th>
<th data-quarto-table-cell-role="th">production</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>1397</td>
<td>3575.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-02</td>
<td>1684</td>
<td>1891.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-03</td>
<td>1796</td>
<td>95.000000</td>
<td>8613.408003</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-04</td>
<td>1249</td>
<td>7459.408003</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-05</td>
<td>2083</td>
<td>5376.408003</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="生産在庫需要の可視化関数-show_prod_inv_demand" class="level3">
<h3 class="anchored" data-anchor-id="生産在庫需要の可視化関数-show_prod_inv_demand">生産、在庫、需要の可視化関数 show_prod_inv_demand</h3>
<p>引数：</p>
<ul>
<li>prod_name: 製品名</li>
<li>production_df: 累積需要量、在庫量、生産量の列をもつデータフレーム</li>
<li>scale: 時間の集約を表す文字列。たとえば1日ごとに表示する場合には “1d” とする。</li>
</ul>
<p>返値：</p>
<ul>
<li>plotlyの図</li>
</ul>
<hr>
<p><a href="https://github.com/scmopt/scmopt2/blob/main/scmopt2/abc.py#L558" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_prod_inv_demand" class="level3">
<h3 class="anchored" data-anchor-id="show_prod_inv_demand">show_prod_inv_demand</h3>
<blockquote class="blockquote">
<pre><code> show_prod_inv_demand (prod_name:str,
                       production_df:pandas.core.frame.DataFrame,
                       scale:str='1d')</code></pre>
</blockquote>
<p>生産、在庫、需要の可視化関数</p>
</section>
<section id="show_prod_inv_demand関数の使用例" class="level3">
<h3 class="anchored" data-anchor-id="show_prod_inv_demand関数の使用例">show_prod_inv_demand関数の使用例</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> show_prod_inv_demand(prod_df.name[<span class="dv">3</span>], production_df, scale<span class="op">=</span><span class="st">"1d"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>plotly.offline.plot(fig)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="01abc_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>